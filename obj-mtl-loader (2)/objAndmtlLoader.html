<!DOCTYPE html>
<html lang="">

<head>
    <meta charset=utf-8>
    <title>My first three.js app</title>
    <style>
        body {
            margin: 0;
        }

        canvas {
            width: 100%;
            height: 100%
        }
    </style>
</head>

<body>
<!-- Three js -->
<script src="../n/three.js-master/build/three.js"></script>

<!-- WebGL 지원유무 https://github.com/mrdoob/three.js/blob/master/examples/js/WebGL.js 참고 -->
<script src="./libs/WebGL.js"></script>

<!-- OrbitControls.js allow the camera to orbit around a target 마우스와 카메라를 상호작용하게 합니다. -->
<script src="../n/three.js-master/examples/js/controls/OrbitControls.js"></script>

<!-- OBJ Loader를 사용하기 위해 추가. https://github.com/mrdoob/three.js/blob/master/examples/js/loaders/OBJLoader.js 와 동일 소스  -->
<script src="../n/three.js-master/examples/js/loaders/OBJLoader.js"></script>

<!-- OBJ Loader에 Material을 씌우기 위한 라이브러리 추가. https://github.com/mrdoob/three.js/blob/master/examples/js/loaders/MTLLoader.js 와 동일 소스 -->
<script src="../n/three.js-master/examples/js/loaders/MTLLoader.js"></script>

<script type="module" src="../n/three.js-master/examples/js/controls/FirstPersonControls.js"></script>

<script type="module">

	window.onload = function (e) {

        let scene = new THREE.Scene();
        let camera;
        let objLoader; // OBJLoader 객체를 넣을 변수를 선언합니다.
        let mtlLoader; // MTLLoader 객체를 넣을 변수를 선언합니다.
		let orbit;
		let plane;
		let object1;
		let controls1;
        let renderer;
        const clock = new THREE.Clock();
        initThree();
        addDirectionalLight();
        loadMTLLoader();

        /**
         * DirectionalLight를 추가하는 함수
         *
         * @method addDirectionalLight
         */
        function addDirectionalLight() {
            let light1 = new THREE.DirectionalLight(0xffffff, 1);
            light1.position.set(-100, 0, 100);
            let light2 = new THREE.DirectionalLight(0xffffff, 1);
            light2.position.set(100, 0, 100);
            let light3 = new THREE.DirectionalLight(0xffffff, 1);
            light3.position.set(100, 0, -100);
            scene.add(light1);
            scene.add(light2);
            scene.add(light3);
        }

        /**
         * Material 파일을 로드하는 함수
         *
         * @method loadMTLLoader
         */
        function loadMTLLoader() {
            mtlLoader = new THREE.MTLLoader();

            // MTLLoader Material 파일을 사용할 전역 경로를 설정합니다.
            mtlLoader.setPath('./resources/Umbreon/');


            // 로드할 Material 파일 명을 입력합니다.
            mtlLoader.load('spongebob-obj/spongebob.mtl', function (materials) {
                // 로드 완료되었을때 호출하는 함수
                materials.preload();

                loadOBJLoader(materials);
            }, function (xhr) {
                // 로드되는 동안 호출되는 함수
                console.log('MTLLoader: ', xhr.loaded / xhr.total * 100, '% loaded');
            }, function (error) {
                // 로드가 실패했을때 호출하는 함수
                console.error('MTLLoader 로드 중 오류가 발생하였습니다.', error);
                alert('MTLLoader 로드 중 오류가 발생하였습니다.');
            });
        }

        /**
         * .obj 파일의 모델을 로드하는 함수
         *
         * @method loadObjLoader
         * @param {Object} materials MTLLoader에서 로드한 Materials 값
         */
        function loadOBJLoader(materials) {
            objLoader = new THREE.OBJLoader();

            // MTLLoader에서 로드한 materials 파일을 설정합니다.
			objLoader.setMaterials(materials);

            // OBJLoader OBJ 파일을 사용할 전역 경로를 설정합니다.
			objLoader.setPath('./resources/Umbreon/');


            // 로드할 OBJ 파일 명을 입력합니다.
			objLoader.load('spongebob-obj/spongebob.obj', function (object) {
                // 모델 로드가 완료되었을때 호출되는 함수
                object.position.x = 3;
                object.position.y = 0;
                object.position.z = 0;
                object.scale.x = 5;
                object.scale.y = 5;
                object.scale.z = 5;
                object1 = object;
                scene.add(object1);
            }, function (xhr) {
                // 모델이 로드되는 동안 호출되는 함수
                console.log('OBJLoader: ', xhr.loaded / xhr.total * 100, '% loaded');
            }, function (error) {
                // 모델 로드가 실패했을 때 호출하는 함수
                alert('모델을 로드 중 오류가 발생하였습니다.');
            });
        }

        /**
         * Threejs 초기화 함수
         *
         * @method initThree
         */
        function initThree() {
            // 브라우저가 WebGL을 지원하는지 체크
            if (WEBGL.isWebGLAvailable()) {
                console.log('이 브라우저는 WEBGL을 지원합니다.');
            } else {
                console.log('이 브라우저는 WEBGL을 지원하지 않습니다.');
            }

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

            plane = new THREE.Mesh(
                new THREE.PlaneGeometry(100, 100),
                new THREE.MeshBasicMaterial({color: 0x000077})
            );
            plane.rotateX(-Math.PI / 2);
            scene.add(plane);

            renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0xffffff, 1); // 전체적인 배경색 수정
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);

            let axes = new THREE.AxisHelper(10);
            scene.add(axes);

            camera.position.x = 1;
            camera.position.y = 3;
            camera.position.z = 3;

            const controls = new THREE.FirstPersonControls(camera, renderer.domElement);
			controls.movementSpeed = 1000;
			controls.lookSpeed = 0.1;
			controls.lookAt(0,0,0);
//             let temp = new THREE.FirstPersonControls();
//             document.addEventListener('mousemove', function (e) {
//                 let scale = -0.01;
//                 orbit.rotateY(e.movementX * scale);
//                 orbit.rotateX(e.movementY * scale);
//                 orbit.rotation.z = 0; //this is important to keep the camera level..
//             })
//
// //the camera rotation pivot
//             orbit = new THREE.Object3D();
//             orbit.rotation.order = "YXZ"; //this is important to keep level, so Z should be the last axis to rotate in order...
//             orbit.position.copy(scene.position);
//             scene.add(orbit);
//
// //offset the camera and add it to the pivot
// //you could adapt the code so that you can 'zoom' by changing the z value in camera.position in a mousewheel event..
//             let cameraDistance = 1;
//             camera.position.z = cameraDistance;
//             orbit.add(camera)


            // const controls = new THREE.OrbitControls(camera, renderer.domElement);
            // controls.rotateSpeed = 1.0;
            // controls.zoomSpeed = 1.2;
            // controls.panSpeed = 0.8;
            // controls.minDistance = 3;
            // controls.maxDistance = 10;
            // controls.keys = {
            //     LEFT: 65,
            //     UP: 87,
            //     RIGHT: 68,
            //     BOTTOM: 83
            // };
            // // controls.autoRotate = true;

            function animate() {
                requestAnimationFrame(animate);
                controls.update(clock.getDelta());
                renderer.render(scene, camera);

            }

        }

    }
</script>
</body>

</html>