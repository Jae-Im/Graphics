<!DOCTYPE html>
<html lang="kr">
<head>
    <title>three.js webgl - geometry - terrain</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <style>
        body {
            background-color: #bfd1e5;
            color: #61443e;
        }
        a {
            color: #a06851;
        }
    </style>
</head>
<body>

<div id="container"></div>
<div id="info">
    <a href="https://threejs.org" target="_blank" rel="noopener">three.js</a>
    - webgl terrain demo<br />
    (left click: forward, right click: backward)
</div>

<script type="module">

    import * as THREE from '../n/three.js-master/build/three.module.js';

    import Stats from '../n/three.js-master/examples/jsm/libs/stats.module.js';

    import { FirstPersonControls } from '../n/three.js-master/examples/jsm/controls/FirstPersonControls.js';
    import { ImprovedNoise } from '../n/three.js-master/examples/jsm/math/ImprovedNoise.js';
    import { OBJLoader} from "../n/three.js-master/examples/jsm/loaders/OBJLoader.js";
    import {MTLLoader} from "../n/three.js-master/examples/jsm/loaders/MTLLoader.js";

    let container, stats;

    let camera, controls, scene, renderer;

    let mesh, texture;

    let object1;

    let mtlLoader, objLoader;

    const worldWidth = 256, worldDepth = 256,
        worldHalfWidth = worldWidth / 2, worldHalfDepth = worldDepth / 2;

    const clock = new THREE.Clock();


    init();
    addDirectionalLight();
    loadMTLLoader();
    animate();

    function addDirectionalLight() {
        let light1 = new THREE.DirectionalLight(0xffffff, 1);
        light1.position.set(-100, 0, 100);
        let light2 = new THREE.DirectionalLight(0xffffff, 1);
        light2.position.set(100, 0, 100);
        let light3 = new THREE.DirectionalLight(0xffffff, 1);
        light3.position.set(100, 0, -100);
        scene.add(light1);
        scene.add(light2);
        scene.add(light3);
    }
    function loadMTLLoader() {
        mtlLoader = new MTLLoader();

        // MTLLoader Material 파일을 사용할 전역 경로를 설정합니다.
        mtlLoader.setPath('./resources/Umbreon/');


        // 로드할 Material 파일 명을 입력합니다.
        mtlLoader.load('ladybug.mtl', function (materials) {
            // 로드 완료되었을때 호출하는 함수
            materials.preload();

            loadOBJLoader(materials);
        }, function (xhr) {
            // 로드되는 동안 호출되는 함수
            console.log('MTLLoader: ', xhr.loaded / xhr.total * 100, '% loaded');
        }, function (error) {
            // 로드가 실패했을때 호출하는 함수
            console.error('MTLLoader 로드 중 오류가 발생하였습니다.', error);
            alert('MTLLoader 로드 중 오류가 발생하였습니다.');
        });
    }

    /**
     * .obj 파일의 모델을 로드하는 함수
     *
     * @method loadObjLoader
     * @param {Object} materials MTLLoader에서 로드한 Materials 값
     */
    function loadOBJLoader(materials) {
        objLoader = new OBJLoader();

        // MTLLoader에서 로드한 materials 파일을 설정합니다.
        objLoader.setMaterials(materials);

        // OBJLoader OBJ 파일을 사용할 전역 경로를 설정합니다.
        objLoader.setPath('./resources/Umbreon/');


        // 로드할 OBJ 파일 명을 입력합니다.
        objLoader.load('ladybug.obj', function (object) {
            // 모델 로드가 완료되었을때 호출되는 함수
            object.position.x = 3;
            object.position.y = 0;
            object.position.z = 0;
            object.scale.x = 5;
            object.scale.y = 5;
            object.scale.z = 5;
            object1 = object;
            scene.add(object1);
        }, function (xhr) {
            // 모델이 로드되는 동안 호출되는 함수
            console.log('OBJLoader: ', xhr.loaded / xhr.total * 100, '% loaded');
        }, function (error) {
            // 모델 로드가 실패했을 때 호출하는 함수
            alert('모델을 로드 중 오류가 발생하였습니다.');
        });
    }
    function init() {

        container = document.getElementById( 'container' );

        camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 20000 );

        scene = new THREE.Scene();
        scene.background = new THREE.Color( 0xbfd1e5 );

        {
            const loader = new THREE.CubeTextureLoader();
            const texture = loader.load([
                './resources/Umbreon/sea.jpg',
                './resources/Umbreon/sea.jpg',
                './resources/Umbreon/sea.jpg',
                './resources/Umbreon/sea.jpg',
                './resources/Umbreon/sea.jpg',
                './resources/Umbreon/sea.jpg'

            ]);
            scene.background = texture;
        }

        camera.position.set(3,3,3);
        const geometry = new THREE.CylinderGeometry( 50, 50, 100, 32 );
        const material = new THREE.MeshBasicMaterial( {color: 0xffff00} );
        const cylinder = new THREE.Mesh( geometry, material );
        scene.add( cylinder );
        let axes = new THREE.AxesHelper(10);
        scene.add(axes);

        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );

        controls = new FirstPersonControls( camera, renderer.domElement );
        controls.movementSpeed = 20;
        controls.lookSpeed = 0.1;

        stats = new Stats();
        container.appendChild( stats.dom );

        //

        window.addEventListener( 'resize', onWindowResize, false );

    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

        controls.handleResize();

    }





    //

    function animate() {


        requestAnimationFrame( animate );

        render();
        stats.update();

    }

    function render() {
        // object1.position.x += 0.01
        controls.update( clock.getDelta() );
        renderer.render( scene, camera );

    }

</script>

</body>
</html>